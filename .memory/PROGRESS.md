---
id: progress
updated: 2025-11-06
---

# Progress (changelog — одна строка на событие)

- 2025-10-08: ADR-0001 accepted — см. DECISIONS.md; contracts v0.1.0 → init.
- 2025-10-16: Завершены задачи 1.3–1.4 (контракты провайдеров обновлены, ADR-0002 по TTL принят, подготовлен протокол ревью).
- 2025-10-16: Уточнены провайдерские контракты (исключены неподтверждённые лимиты, синхронизирована ADR-0002 с требованиями SDD).
- 2025-10-16: Контракты обновлены до v0.1.1 — уточнены OpenAPI и JSON Schema (AuthToken, Settings, Result, TTL поля).
- 2025-10-16: Фаза 1 (SPEC REVIEW) завершена — статусы обновлены, все подпункты 1.1–1.4 закрыты и отражены в мемори-банке.
- 2025-10-16: Выполнен подпункт 2.1 — сгенерированы свежие стабы (OpenAPI v0.1.2), синхронизированы enum-параметры и клиентские типы.
- 2025-10-18: Завершены подпункты 2.2–2.3 (аудит сервисов, Postgres очередь, UI конфиг, backlog обновлён).
- 2025-10-18: Фаза 2 (STUBS GEN) завершена — статусы обновлены, инфраструктурные заглушки и UI scaffolding готовы к переходу на контрактные тесты.
- 2025-10-18: Выполнены сабтаски 3.1.1–3.1.2 — добавлены позитивные/негативные контрактные тесты ingest, админ-API и публичных ссылок, проверка схем ошибок подтверждена запуском pytest -m contract.
- 2025-10-19: Завершены сабтаски 3.2.1–3.2.2 — реализованы интеграционные тесты очереди и воркера, покрыты сценарии финализации, отмены и таймаута, тесты contract/integration проходят.
- 2025-10-19: Завершены сабтаски 3.3.1–3.3.2 — добавлены детерминированные моки Gemini/Turbotext с режимами success/timeout/error, фикстуры pytest и контрактные проверки provider mocks.
- 2025-10-20: Сабтаски 3.4.1–3.4.2 закрыты — реализованы расчёты дедлайнов/TTL, unit-тесты TTL зелёные (`pytest -m unit`).
- 2025-10-20: Фаза 3 (CONTRACT TESTS GREEN) завершена — contract/unit отчёты приложены, чек-лист Фазы 3 выполнен.
- 2025-10-21: Повторно подтверждена готовность Фазы 3 — переустановлены зависимости окружения, тесты `pytest -m unit` и `pytest -m contract` зелёные, отчёт tests/TEST_REPORT_PHASE3.md обновлён.
- 2025-10-22: Подготовлена детальная декомпозиция Фазы 4 (ingest, очередь, воркеры, admin, security, observability) в .memory/TASKS.md с учётом TTL, очередей и требований безопасности.
- 2025-10-22: Выполнены сабтаски 4.3.2–4.3.6 и 4.3.8 — реализован `QueueWorker` с полным циклом провайдера, обновлён DI реестр и добавлены интеграционные тесты dispatch/timeout/error.
- 2025-10-23: Выполнены сабтаски 4.1.1–4.1.5 — внедрены default сервисы, реализован ingest endpoint с валидацией/сохранением payload, очередь и тесты unit/contract зелёные.
- 2025-10-24: Подтверждена соответствие ingest core спецификациям/бриву — фабрики DI получают AppConfig, прогнаны ruff/mypy/pytest -m "unit or contract" (зелёные).
- 2025-10-25: Завершены сабтаски 4.1.6–4.1.10 — ingest стал синхронным (polling, очистка, 429/504), обновлены тесты и ops runbook, ruff/mypy/pytest -m unit/contract зелёные.
- 2025-10-16: Стартована реализация сабтасков 4.2.x — добавлен SQLite-бэкенд PostgresJobQueue, unit-тесты (pytest -m unit требует fastapi).
- 2025-10-28: Сабтаски 4.2.1 и 4.2.8 закрыты — добавлены Alembic-миграции очереди (`jobs`/`processing_logs`), прокинут `queue_statement_timeout_ms` в AppConfig и обновлена документация по миграциям.
- 2025-10-28: Сабтаски 4.2.10–4.2.11 закрыты — подтверждён приоритет таблицы `processing_logs`, добавлен конфиг `queue_max_in_flight_jobs=12` и обновлены runbook/ingest инструкции по back-pressure.
- 2025-10-29: Согласован план по воркерам — фиксирован пул из четырёх фоновых задач в FastAPI, ретраи 5× (таймаут 5 с, пауза 3 с), graceful shutdown с закрытием HTTP-клиентов; обновлены спецификации и ops runbook.
- 2025-10-29: Сабтаски 4.3.1/4.3.9/4.3.12 выполнены — QueueWorker переведён на asyncio с retry 5×/3 с/5 с, DI запускает пул из четырёх фоновых воркеров, обеспечен graceful shutdown и закрытие клиентов.
- 2025-10-29: Сабтаск 4.4.1 выполнен — MediaService сохраняет итоговые файлы с checksum и TTL 72h, QueueWorker использует новый интерфейс, интеграционные стабы обновлены.
- 2025-10-30: Сабтаски 4.4.2–4.4.5 и 4.4.9 завершены — публичные ссылки выдают 307/410 с TTL 72h, очиститель результатов работает, pytest -m "unit or contract" зелёный.
- 2025-10-31: Подготовлены материалы для CONSULT 4.5.C2 и 4.5.Q1 — собраны варианты горизонтов статистики, структура `recent_results` и перечень UX-вопросов; отправлены запросы тимлиду, ожидаем подтверждения решений.
- 2025-10-31: CONSULT 4.5.C2 и 4.5.Q1 завершены — утверждены дефолтные горизонты статистики (14 дней/8 недель), кеш 5/1 мин, `recent_results` = 10 успешных задач за 72 ч, автообновление UI раз в 60 с и CSV-экспорт без дополнительных графиков.
- 2025-11-02: Сабтаски 4.5.3a–4.5.3c выполнены — SettingsService реализован, покрыт тестами и задокументирован; 4.5.4/4.5.5 остаются в работе до исправления выявленных на ревью дефектов.
- 2025-11-04: Сабтаски 4.5.4a–4.5.4d выполнены — SlotManagementService реализован с проверками провайдеров/шаблонов, обновлены DTO/репозитории и unit-тесты `tests/unit/services/test_slot_service.py` проходят (pytest).
- 2025-11-04: Сабтаск 4.5.2b завершён — SQLAlchemy репозитории дополнились TemplateMediaRepository, обеспечены фильтры/транзакции/обработка ошибок и синхронизированы .memory-файлы.
- 2025-11-05: Сабтаски 4.5.4/4.5.5 подтверждены — `SlotService` и `CachedStatsService` проходят ревью, разделены TTL статистики, добавлен кеш recent_results и unit-тесты `tests/unit/services/test_stats_service.py` зелёные.
- 2025-11-05: Сабтаски 4.5.6b1–4.5.6b3 выполнены — JobService фиксирует ProcessingLog (create/finalize/fail) и публикует события в StatsService, QueueWorker делегирует сервису и обогащает детали логов, unit/integration тесты обновлены.
- 2025-11-05: Сабтаск 4.5.6c завершён — дефолтная конфигурация использует `PostgresJobQueue` и `CachedStatsService`, кеш настраивается через `PHOTOCHANGER_STATS_*`, добавлен интеграционный тест `test_default_pipeline` и обновлена документация.
- 2025-11-05: Сабтаск 4.5.6d закрыт — добавлен smoke-тест stats-пайплайна, обновлены AppConfig/README/.env и шаблоны конфигураций для dev/staging/prod, описаны новые переменные окружения в runbook.【F:tests/integration/test_stats_pipeline.py†L1-L200】【F:src/app/core/config.py†L37-L125】【F:configs/app.prod.json†L1-L17】【F:README.md†L10-L20】【F:spec/docs/operations/ingest_runbook.md†L11-L27】
- 2025-11-05: Сабтаски 4.5.6e завершены — утверждён контракт ProcessingLog (JSON Schema/OpenAPI), StatsService валидирует события и добавлены contract/unit тесты.
- 2025-11-06: Убрали SQLite-фоллбек, stats репозиторий теперь требует PostgreSQL/psycopg; unit-тесты репозиториев переведены на
  postgres_dsn, README/runbook/tests/HOWTO обновлены инструкциями по локальной БД.
