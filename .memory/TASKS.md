---
id: tasks
updated: 2025-10-18
---

# Tasks (канбан)

## TODO
- [ ] **3. Фаза 3 — Тестирование контрактов и инфраструктуры (CONTRACT TESTS GREEN)**
  - *Цель:* обеспечить автоматическую проверку API/очереди/TTL до реализации бизнес-логики.
  - *Задачи:*
    - [x] 3.1 Построить контрактные тесты API.
      - [x] 3.1.1 Покрыть ingest, админ-API и публичные ссылки позитивными сценариями.
      - [x] 3.1.2 Добавить негативные сценарии и проверки ошибок валидации.
    - [x] 3.2 Настроить интеграционные тесты очереди.
      - [x] 3.2.1 Смоделировать постановку `Job`, работу воркера и соблюдение `expires_at`.
      - [x] 3.2.2 Проверить ручную отмену и очистку просроченных задач.
    - [x] 3.3 Разработать моки провайдеров.
      - [x] 3.3.1 Реализовать режимы «успех», «таймаут», «ошибка» для Gemini.
      - [x] 3.3.2 Реализовать аналогичные режимы и ограничения для Turbotext.
    - [ ] 3.4 Создать unit-тесты TTL и очистки медиа.
      - [ ] 3.4.1 Покрыть расчёт `T_sync_response`, `T_public_link_ttl`, `T_result_retention`.
      - [ ] 3.4.2 Проверить процедуры очистки медиа и генерацию `410 Gone`.
  - *Выходные артефакты:* зелёные `pytest -m contract`, `pytest -m unit` для TTL, тестовые заглушки провайдеров.

- [ ] **4. Фаза 4 — Реализация серверного приложения (IMPL)**
  - *Цель:* реализовать основную бизнес-логику ingest/очереди/воркеров/админ-API.
  - *Задачи:*
    - [ ] 4.1 Завершить Ingest API.
      - [ ] 4.1.1 Реализовать валидацию входных данных и создание `Job`.
      - [ ] 4.1.2 Сохранить payload, настроить polling статуса и обработку таймаутов в пределах `T_sync_response`.
    - [ ] 4.2 Реализовать очередь на PostgreSQL.
      - [ ] 4.2.1 Настроить контроль параллелизма и back-pressure.
      - [ ] 4.2.2 Добавить очистку просроченных задач и отложенных записей.
    - [ ] 4.3 Разработать воркеры обработки задач.
      - [ ] 4.3.1 Интегрировать провайдеров и управление `expires_at`.
      - [ ] 4.3.2 Сохранить результаты и заполнение `ProcessingLog`.
    - [ ] 4.4 Настроить хранение результатов и публичные ссылки.
      - [ ] 4.4.1 Сохранить результаты в `MEDIA_ROOT/results` и публиковать ссылки.
      - [ ] 4.4.2 Реализовать очиститель, возвращающий `410 Gone` после истечения `result_expires_at`.
    - [ ] 4.5 Разработать Admin API.
      - [ ] 4.5.1 Реализовать CRUD слотов и управление настройками/шаблонами.
      - [ ] 4.5.2 Сформировать статистику и `recent_results`.
    - [ ] 4.6 Добавить авторизацию и безопасность.
      - [ ] 4.6.1 Настроить JWT и роли (`settings:write`, `slots:write`).
      - [ ] 4.6.2 Реализовать ротацию ingest-пароля и хранение хэшей.
    - [ ] 4.7 Внедрить логирование и метрики.
      - [ ] 4.7.1 Добавить базовые лог-события для ingest/воркеров/очереди.
      - [ ] 4.7.2 Настроить метрики таймаутов и ретраев согласно NFR.
  - *Выходные артефакты:* рабочее серверное приложение со всеми API и внутренними сервисами, обновлённая документация по запуску.

- [ ] **5. Фаза 5 — Интеграция провайдеров и UI**
  - *Цель:* подключить реальные провайдеры и завершить административный интерфейс.
  - *Задачи:*
    - [ ] 5.1 Интегрировать адаптер Gemini.
      - [ ] 5.1.1 Подключить `models.generateContent` и Files API.
      - [ ] 5.1.2 Настроить обработку квот, ретраев и преобразование ответов в доменную модель.
    - [ ] 5.2 Интегрировать адаптер Turbotext.
      - [ ] 5.2.1 Реализовать регистрацию `media_object` и polling `queueid`.
      - [ ] 5.2.2 Обеспечить соблюдение `T_sync_response` и обработку ошибок биллинга.
    - [ ] 5.3 Завершить административный UI.
      - [ ] 5.3.1 Реализовать динамические формы настроек слота и галерею `recent_results`.
      - [ ] 5.3.2 Добавить копирование ingest-ссылки и страницы статистики.
    - [ ] 5.4 Реализовать публичные страницы скачивания.
      - [ ] 5.4.1 Отобразить результаты с учётом TTL и статусов ссылок.
      - [ ] 5.4.2 Обработать истечение TTL с возвратом `410 Gone` и подсказками пользователю.
  - *Выходные артефакты:* подключенные провайдеры, функциональный UI, подтверждённые ручными сценариями.

- [ ] **6. Фаза 6 — Нефункциональные требования и эксплуатация**
  - *Цель:* обеспечить эксплуатационные характеристики, безопасность и управляемость.
  - *Задачи:*
    - [ ] 6.1 Ограничить параллелизм и rate limiting.
      - [ ] 6.1.1 Настроить лимиты по провайдерам и очереди.
      - [ ] 6.1.2 Ввести ограничители ingest/админ-API с учётом SLA.
    - [ ] 6.2 Настроить сбор и экспорт метрик.
      - [ ] 6.2.1 Собрать метрики ingest latency, таймаутов, polling, очисток.
      - [ ] 6.2.2 Настроить экспорт в Prometheus/логи и алерты по SLA.
    - [ ] 6.3 Усилить безопасность хранения секретов.
      - [ ] 6.3.1 Организовать защищённое хранение `app_settings` и `provider_secret`.
      - [ ] 6.3.2 Настроить TLS-конфигурацию и ротацию ключей.
    - [ ] 6.4 Автоматизировать фоновые очистки.
      - [ ] 6.4.1 Настроить процессы очистки payload/media_object/results.
      - [ ] 6.4.2 Обеспечить корректную обработку `410 Gone` для просроченных ссылок.
  - *Выходные артефакты:* включённые NFR-контроли, документация по эксплуатации и мониторингу.

- [ ] **7. Фаза 7 — End-to-End тестирование и релизная подготовка (E2E GREEN)**
  - *Цель:* подтвердить готовность платформы к релизу.
  - *Задачи:*
    - [ ] 7.1 Прогнать e2e сценарии.
      - [ ] 7.1.1 Проверить успешный ingest, таймаут 504 и сбой провайдера.
      - [ ] 7.1.2 Проверить истечение публичной ссылки и скачивание результатов через UI.
    - [ ] 7.2 Провести нагрузочное тестирование.
      - [ ] 7.2.1 Измерить p95, долю 504 и устойчивость очереди.
      - [ ] 7.2.2 Зафиксировать поведение ретраев и деградаций.
    - [ ] 7.3 Обновить регрессионные чек-листы.
      - [ ] 7.3.1 Согласовать обновления UI/API чек-листов с test-plan.
      - [ ] 7.3.2 Обновить сценарии в репозитории QA.
    - [ ] 7.4 Подготовить релизную документацию.
      - [ ] 7.4.1 Актуализировать README и инструкции по провайдерам.
      - [ ] 7.4.2 Описать эксплуатационные регламенты и процедуру релиза.
  - *Выходные артефакты:* отчёты по e2e и нагрузочным тестам, актуальная документация.

- [ ] **8. Фаза 8 — Оперативная поддержка и эволюция**
  - *Цель:* обеспечить непрерывную поддержку и развитие платформы после релиза.
  - *Задачи:*
    - [ ] 8.1 Настроить процесс Re-Sync при изменении брифа.
      - [ ] 8.1.1 Организовать мониторинг изменений брифа и связанных артефактов.
      - [ ] 8.1.2 Обновлять контракты и реализации через SDD-ворота по результатам мониторинга.
    - [ ] 8.2 Сформировать и приоритизировать backlog улучшений.
      - [ ] 8.2.1 Собрать предложения по новым провайдерам, операциям и аналитике.
      - [ ] 8.2.2 Оценить ценность и сложность, составить roadmap эволюции.
    - [ ] 8.3 Настроить эксплуатационные алерты и резервное копирование.
      - [ ] 8.3.1 Ввести алерты по SLA (`T_sync_response`, процент 504) и квотам провайдеров.
      - [ ] 8.3.2 Настроить резервное копирование шаблонов и результатов, регламенты восстановления.
  - *Выходные артефакты:* план эволюции, операционные процедуры, дашборды SLA.

## DOING
- *(пока пусто)*

## DONE
- [x] **2. Фаза 2 — Генерация стабов и scaffolding (STUBS GEN)**
  - *Цель:* подготовить минимально жизнеспособные каркасы API/доменных сервисов.
  - *Задачи:*
    - [x] 2.1 Обновить каркасы, сгенерированные из OpenAPI.
      - [x] 2.1.1 Сгенерировать или обновить контроллеры, DTO и клиентские типы.
      - [x] 2.1.2 Сопоставить с существующими стабами и удалить устаревшие элементы.
    - [x] 2.2 Провести аудит доменных сервисов и репозиториев.
      - [x] 2.2.1 Проверить каркасы `JobService`, `SlotService`, `SettingsService`, `MediaService`, `StatsService`, `QueueWorker`.
      - [x] 2.2.2 Составить backlog недостающих интерфейсов и зависимостей.
    - [x] 2.3 Подготовить инфраструктурные заглушки.
      - [x] 2.3.1 Настроить очередь на PostgreSQL с `SELECT … FOR UPDATE SKIP LOCKED`.
      - [x] 2.3.2 Настроить стораджи медиа (`MEDIA_ROOT`) и провайдерские адаптеры.
    - [x] 2.3.3 Актуализировать конфигурацию UI.
    - [x] 2.4 Обновить UI scaffolding без бизнес-логики.
      - [x] 2.4.1 Пересобрать страницы списка слотов и настройки слота.
      - [x] 2.4.2 Подготовить страницы статистики и просмотра результатов с заглушечными данными.
  - *Выходные артефакты:* репозитории/сервисы без бизнес-логики, актуальные заглушки UI и адаптеров, чек-лист готовности к тестам.

- [x] **1. Фаза 1 — Контракты и схемы (SPEC REVIEW)**
  - *Цель:* подтвердить полноту и корректность HTTP/JSON контрактов до генерации стабов.
  - *Задачи:*
    - [x] 1.1 Провести ревью OpenAPI.
      - [x] 1.1.1 Проверить ingest-эндпоинты, админ-API (`/api/slots`, `/api/settings`, `/api/stats/*`) и публичную выдачу `GET/public/results/{job_id}`.
      - [x] 1.1.2 Убедиться в корректности статусов 200/400/401/403/410/504 и описаний ошибок.
    - [x] 1.2 Верифицировать JSON Schema сущностей.
      - [x] 1.2.1 Сопоставить определения `Slot`, `Job`, `MediaObject`, `TemplateMedia`, `Result`, `Settings`, `AuthToken`, `Error`.
      - [x] 1.2.2 Проверить согласованность TTL (`T_sync_response`, `T_public_link_ttl`, `T_result_retention`) между схемами и текстовыми описаниями.
    - [x] 1.3 Сверить спецификации провайдеров с контрактами.
      - [x] 1.3.1 Сопоставить ограничения Gemini из `Docs/providers/gemini.md` с OpenAPI и доменной моделью.
      - [x] 1.3.2 Сравнить лимиты Turbotext (`Docs/providers/turbotext.md`) и требования очереди.
    - [x] 1.4 Подготовить архитектурные решения по TTL и очистке медиа.
      - [x] 1.4.1 Проверить наличие актуальных ADR по TTL, polling БД и очистке медиа.
      - [x] 1.4.2 При необходимости подготовить обновления ADR или зафиксировать подтверждение актуальности.
  - *Выходные артефакты:* протокол ревью контрактов, ADR по ключевым решениям или подтверждение актуальности.

- [x] **0. Фаза 0 — Аналитика и синхронизация SDD**
  - *Цель:* убедиться, что артефакты SDD и бриф согласованы перед началом реализации.
  - *Задачи:*
    - [x] 0.1 Сверить артефакты брифа и SDD.
      - [x] 0.1.1 Сопоставить `Docs/brief.md` с `spec/docs/blueprints/*` по сущностям, сценариям и ограничениям.
      - [x] 0.1.2 Сравнить `Docs/brief.md` с `spec/contracts/openapi.yaml` по эндпоинтам и статусам, отметить расхождения для цикла Re-Sync.
      - [x] 0.1.3 Обновить чек-лист контроля в `agents.md` с учётом выявленных расхождений.
    - [x] 0.2 Подтвердить актуальность ключевых SDD-артефактов.
      - [x] 0.2.1 Перепроверить vision/context/domain-model/test-plan согласно `Docs/sdd_roadmap.md`.
      - [x] 0.2.2 Зафиксировать требуемые ревью, список ответственных и сроки актуализации.
  - *Выходные артефакты:* протокол ревью SDD, обновлённый чек-лист контроля, перечень выявленных gap.
