---
id: tasks
updated: 2025-10-16
---

# Tasks (канбан)

## TODO
- [ ] **Фаза 0 — Аналитика и синхронизация SDD**
  - *Цель:* убедиться, что артефакты SDD и бриф согласованы перед началом реализации.
  - *Задачи:*
    - [ ] Сверить артефакты брифа и SDD.
      - [ ] Сопоставить `Docs/brief.md` с `spec/docs/blueprints/*` по сущностям, сценариям и ограничениям.
      - [ ] Сравнить `Docs/brief.md` с `spec/contracts/openapi.yaml` по эндпоинтам и статусам, отметить расхождения для цикла Re-Sync.
      - [ ] Обновить чек-лист контроля в `agents.md` с учётом выявленных расхождений.
    - [ ] Подтвердить актуальность ключевых SDD-артефактов.
      - [ ] Перепроверить vision/context/domain-model/test-plan согласно `Docs/sdd_roadmap.md`.
      - [ ] Зафиксировать требуемые ревью, список ответственных и сроки актуализации.
  - *Выходные артефакты:* протокол ревью SDD, обновлённый чек-лист контроля, перечень выявленных gap.

- [ ] **Фаза 1 — Контракты и схемы (SPEC REVIEW)**
  - *Цель:* подтвердить полноту и корректность HTTP/JSON контрактов до генерации стабов.
  - *Задачи:*
    - [ ] Провести ревью OpenAPI.
      - [ ] Проверить ingest-эндпоинты, админ-API (`/api/slots`, `/api/settings`, `/api/stats/*`) и публичную выдачу `GET /public/results/{job_id}`.
      - [ ] Убедиться в корректности статусов 200/400/401/403/410/504 и описаний ошибок.
    - [ ] Верифицировать JSON Schema сущностей.
      - [ ] Сопоставить определения `Slot`, `Job`, `MediaObject`, `TemplateMedia`, `Result`, `Settings`, `AuthToken`, `Error`.
      - [ ] Проверить согласованность TTL (`T_sync_response`, `T_public_link_ttl`, `T_result_retention`) между схемами и текстовыми описаниями.
    - [ ] Сверить спецификации провайдеров с контрактами.
      - [ ] Сопоставить ограничения Gemini из `Docs/providers/gemini.md` с OpenAPI и доменной моделью.
      - [ ] Сравнить лимиты Turbotext (`Docs/providers/turbotext.md`) и требования очереди.
    - [ ] Подготовить архитектурные решения по TTL и очистке медиа.
      - [ ] Проверить наличие актуальных ADR по TTL, polling БД и очистке медиа.
      - [ ] При необходимости подготовить обновления ADR или зафиксировать подтверждение актуальности.
  - *Выходные артефакты:* протокол ревью контрактов, ADR по ключевым решениям или подтверждение актуальности.

- [ ] **Фаза 2 — Генерация стабов и scaffolding (STUBS GEN)**
  - *Цель:* подготовить минимально жизнеспособные каркасы API/доменных сервисов.
  - *Задачи:*
    - [ ] Обновить каркасы, сгенерированные из OpenAPI.
      - [ ] Сгенерировать или обновить контроллеры, DTO и клиентские типы.
      - [ ] Сопоставить с существующими стабами и удалить устаревшие элементы.
    - [ ] Провести аудит доменных сервисов и репозиториев.
      - [ ] Проверить каркасы `JobService`, `SlotService`, `SettingsService`, `MediaService`, `StatsService`, `QueueWorker`.
      - [ ] Составить backlog недостающих интерфейсов и зависимостей.
    - [ ] Подготовить инфраструктурные заглушки.
      - [ ] Настроить очередь на PostgreSQL с `SELECT … FOR UPDATE SKIP LOCKED`.
      - [ ] Настроить стораджи медиа (`MEDIA_ROOT`) и провайдерские адаптеры.
      - [ ] Актуализировать конфигурацию UI.
    - [ ] Обновить UI scaffolding без бизнес-логики.
      - [ ] Пересобрать страницы списка слотов и настройки слота.
      - [ ] Подготовить страницы статистики и просмотра результатов с заглушечными данными.
  - *Выходные артефакты:* репозитории/сервисы без бизнес-логики, актуальные заглушки UI и адаптеров, чек-лист готовности к тестам.

- [ ] **Фаза 3 — Тестирование контрактов и инфраструктуры (CONTRACT TESTS GREEN)**
  - *Цель:* обеспечить автоматическую проверку API/очереди/TTL до реализации бизнес-логики.
  - *Задачи:*
    - [ ] Построить контрактные тесты API.
      - [ ] Покрыть ingest, админ-API и публичные ссылки позитивными сценариями.
      - [ ] Добавить негативные сценарии и проверки ошибок валидации.
    - [ ] Настроить интеграционные тесты очереди.
      - [ ] Смоделировать постановку `Job`, работу воркера и соблюдение `expires_at`.
      - [ ] Проверить ручную отмену и очистку просроченных задач.
    - [ ] Разработать моки провайдеров.
      - [ ] Реализовать режимы «успех», «таймаут», «ошибка» для Gemini.
      - [ ] Реализовать аналогичные режимы и ограничения для Turbotext.
    - [ ] Создать unit-тесты TTL и очистки медиа.
      - [ ] Покрыть расчёт `T_sync_response`, `T_public_link_ttl`, `T_result_retention`.
      - [ ] Проверить процедуры очистки медиа и генерацию `410 Gone`.
  - *Выходные артефакты:* зелёные `pytest -m contract`, `pytest -m unit` для TTL, тестовые заглушки провайдеров.

- [ ] **Фаза 4 — Реализация серверного приложения (IMPL)**
  - *Цель:* реализовать основную бизнес-логику ingest/очереди/воркеров/админ-API.
  - *Задачи:*
    - [ ] Завершить Ingest API.
      - [ ] Реализовать валидацию входных данных и создание `Job`.
      - [ ] Сохранить payload, настроить polling статуса и обработку таймаутов в пределах `T_sync_response`.
    - [ ] Реализовать очередь на PostgreSQL.
      - [ ] Настроить контроль параллелизма и back-pressure.
      - [ ] Добавить очистку просроченных задач и отложенных записей.
    - [ ] Разработать воркеры обработки задач.
      - [ ] Интегрировать провайдеров и управление `expires_at`.
      - [ ] Сохранить результаты и заполнение `ProcessingLog`.
    - [ ] Настроить хранение результатов и публичные ссылки.
      - [ ] Сохранить результаты в `MEDIA_ROOT/results` и публиковать ссылки.
      - [ ] Реализовать очиститель, возвращающий `410 Gone` после истечения `result_expires_at`.
    - [ ] Разработать Admin API.
      - [ ] Реализовать CRUD слотов и управление настройками/шаблонами.
      - [ ] Сформировать статистику и `recent_results`.
    - [ ] Добавить авторизацию и безопасность.
      - [ ] Настроить JWT и роли (`settings:write`, `slots:write`).
      - [ ] Реализовать ротацию ingest-пароля и хранение хэшей.
    - [ ] Внедрить логирование и метрики.
      - [ ] Добавить базовые лог-события для ingest/воркеров/очереди.
      - [ ] Настроить метрики таймаутов и ретраев согласно NFR.
  - *Выходные артефакты:* рабочее серверное приложение со всеми API и внутренними сервисами, обновлённая документация по запуску.

- [ ] **Фаза 5 — Интеграция провайдеров и UI**
  - *Цель:* подключить реальные провайдеры и завершить административный интерфейс.
  - *Задачи:*
    - [ ] Интегрировать адаптер Gemini.
      - [ ] Подключить `models.generateContent` и Files API.
      - [ ] Настроить обработку квот, ретраев и преобразование ответов в доменную модель.
    - [ ] Интегрировать адаптер Turbotext.
      - [ ] Реализовать регистрацию `media_object` и polling `queueid`.
      - [ ] Обеспечить соблюдение `T_sync_response` и обработку ошибок биллинга.
    - [ ] Завершить административный UI.
      - [ ] Реализовать динамические формы настроек слота и галерею `recent_results`.
      - [ ] Добавить копирование ingest-ссылки и страницы статистики.
    - [ ] Реализовать публичные страницы скачивания.
      - [ ] Отобразить результаты с учётом TTL и статусов ссылок.
      - [ ] Обработать истечение TTL с возвратом `410 Gone` и подсказками пользователю.
  - *Выходные артефакты:* подключенные провайдеры, функциональный UI, подтверждённые ручными сценариями.

- [ ] **Фаза 6 — Нефункциональные требования и эксплуатация**
  - *Цель:* обеспечить эксплуатационные характеристики, безопасность и управляемость.
  - *Задачи:*
    - [ ] Ограничить параллелизм и rate limiting.
      - [ ] Настроить лимиты по провайдерам и очереди.
      - [ ] Ввести ограничители ingest/админ-API с учётом SLA.
    - [ ] Настроить сбор и экспорт метрик.
      - [ ] Собрать метрики ingest latency, таймаутов, polling, очисток.
      - [ ] Настроить экспорт в Prometheus/логи и алерты по SLA.
    - [ ] Усилить безопасность хранения секретов.
      - [ ] Организовать защищённое хранение `app_settings` и `provider_secret`.
      - [ ] Настроить TLS-конфигурацию и ротацию ключей.
    - [ ] Автоматизировать фоновые очистки.
      - [ ] Настроить процессы очистки payload/media_object/results.
      - [ ] Обеспечить корректную обработку `410 Gone` для просроченных ссылок.
  - *Выходные артефакты:* включённые NFR-контроли, документация по эксплуатации и мониторингу.

- [ ] **Фаза 7 — End-to-End тестирование и релизная подготовка (E2E GREEN)**
  - *Цель:* подтвердить готовность платформы к релизу.
  - *Задачи:*
    - [ ] Прогнать e2e сценарии.
      - [ ] Проверить успешный ingest, таймаут 504 и сбой провайдера.
      - [ ] Проверить истечение публичной ссылки и скачивание результатов через UI.
    - [ ] Провести нагрузочное тестирование.
      - [ ] Измерить p95, долю 504 и устойчивость очереди.
      - [ ] Зафиксировать поведение ретраев и деградаций.
    - [ ] Обновить регрессионные чек-листы.
      - [ ] Согласовать обновления UI/API чек-листов с test-plan.
      - [ ] Обновить сценарии в репозитории QA.
    - [ ] Подготовить релизную документацию.
      - [ ] Актуализировать README и инструкции по провайдерам.
      - [ ] Описать эксплуатационные регламенты и процедуру релиза.
  - *Выходные артефакты:* отчёты по e2e и нагрузочным тестам, актуальная документация.

- [ ] **Фаза 8 — Оперативная поддержка и эволюция**
  - *Цель:* обеспечить непрерывную поддержку и развитие платформы после релиза.
  - *Задачи:*
    - [ ] Настроить процесс Re-Sync при изменении брифа.
      - [ ] Организовать мониторинг изменений брифа и связанных артефактов.
      - [ ] Обновлять контракты и реализации через SDD-ворота по результатам мониторинга.
    - [ ] Сформировать и приоритизировать backlog улучшений.
      - [ ] Собрать предложения по новым провайдерам, операциям и аналитике.
      - [ ] Оценить ценность и сложность, составить roadmap эволюции.
    - [ ] Настроить эксплуатационные алерты и резервное копирование.
      - [ ] Ввести алерты по SLA (`T_sync_response`, процент 504) и квотам провайдеров.
      - [ ] Настроить резервное копирование шаблонов и результатов, регламенты восстановления.
  - *Выходные артефакты:* план эволюции, операционные процедуры, дашборды SLA.

## DOING
- *(пока пусто)*

## DONE
- *(пока пусто)*
