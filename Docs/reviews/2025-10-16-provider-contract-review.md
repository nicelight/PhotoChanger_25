# Ревью контрактов провайдеров (2025-10-16)

## Цель
Подтвердить согласованность ограничений провайдеров Gemini и Turbotext с OpenAPI, доменной моделью и внутренними адаптерами платформы.

## Обзор источников
- `Docs/providers/gemini.md`, `Docs/providers/turbotext.md` — официальные выдержки и ограничения провайдеров.
- `spec/contracts/providers/*.md` — контрактные ожидания платформы.
- `spec/contracts/openapi.yaml`, схемы `Job`, `Settings`, `Media*` — ограничения TTL и полей.
- `spec/docs/blueprints/domain-model.md`, `use-cases.md` — сценарии жизненного цикла задач и работы очереди.

## Наблюдения и правки
### Gemini
- Актуальная документация подтверждает единый метод `models.generateContent` и работу с `inline_data`/`file_data`; отдельные endpoints `transferStyle`, `compose` не используются. Контракт обновлён: операции описаны через формирование `contents`, Files API и промпты.
- Files API хранит объекты до 48 часов (≤2 ГБ на файл, ≤20 ГБ на проект). Контракт фиксирует переход на Files API для крупных payload и связывает его с дедлайном `T_sync_response`.
- Добавлен блок об аутентификации `x-goog-api-key`, квотах Tier 2 и необходимости ограничивать параллелизм провайдера через очередь.

### Turbotext
- Подтверждён протокол `create_queue` → `get_result` с обязательным заголовком `Authorization: Bearer`. Контракт обновлён, чтобы описывать шаги явно.
- Ограничения по MIME сохранены, подчёркнута необходимость поддерживать TTL публичных ссылок = `T_sync_response` и конфигурацию параллелизма Turbotext.
- Добавлены маппинги параметров операций, требования к polling/backoff и загрузке итогового файла в `Job.result_*`.

## Выводы
- Спецификации провайдеров приведены в соответствие с официальными ограничениями и доменной моделью.
- Очередь и TTL в OpenAPI/схемах не требуют доработок: `T_sync_response`, `Job.result_*` и очистка соответствуют обновлённым описаниям провайдеров.
- Для фиксации архитектурных решений по TTL подготовлен ADR-0002 (см. `spec/adr/ADR-0002.md`).

## Риски и последующие шаги
- Необходимо реализовать мониторинг квот (`429 RESOURCE_EXHAUSTED`), описанный в контракте Gemini, при разработке адаптера.
- Требуется внедрить автоматические проверки наличия публичных ссылок при обращении к Turbotext (unit/contract тесты на этапе Фазы 3).
