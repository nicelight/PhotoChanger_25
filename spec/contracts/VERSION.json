{
  "version": "0.9.1",
  "released_at": "2025-12-03",
  "stage": "draft",
  "summary": "Полный ingest-поток: провайдер вызывается с бинарным ответом, слот блокирует параллельные запросы; hash mismatch остаётся предупреждением.",
  "changes": [
    {
      "type": "init",
      "description": "Defined ingest flow expectations (`POST /api/ingest/{slot_id}`) and media TTL behaviour.",
      "artifacts": [
        "spec/docs/providers/gemini.md",
        "spec/docs/providers/turbotext.md"
      ]
    },
    {
      "type": "init",
      "description": "Outlined admin APIs for slots, settings, statistics and public results delivery.",
      "artifacts": [
        "docs/PRD.md",
        "docs/ARCHITECTURE.md",
        "spec/docs/use-cases.md"
      ]
    },
    {
      "type": "docs",
      "description": "Added draft OpenAPI 3.1 specification for ingest endpoint, referencing multipart and error schemas.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "spec/contracts/schemas/ingest-request.schema.json",
        "spec/contracts/schemas/ingest-error.schema.json",
        "spec/contracts/ingest-errors.md"
      ]
    },
    {
      "type": "docs",
      "description": "Expanded ingest OpenAPI with examples and SLA description.",
      "artifacts": [
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Refined provider contracts for Gemini and Turbotext (limits, protocols, error handling).",
      "artifacts": [
        "spec/docs/providers/gemini.md",
        "spec/docs/providers/turbotext.md"
      ]
    },
    {
      "type": "docs",
      "description": "Simplified ingest media support to JPEG/PNG/WebP across PRD, SDD, and contracts.",
      "artifacts": [
        "docs/PRD.md",
        "spec/docs/use-cases.md",
        "spec/docs/nfr.md",
        "spec/contracts/schemas/ingest-request.schema.json",
        "spec/contracts/ingest-errors.md",
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Documented `/public/results/{job_id}` downloads, including 404/410 error payloads.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md"
      ]
    },
    {
      "type": "feature",
      "description": "Introduced `/api/slots/{slot_id}/test-run` and `job_history.source` to distinguish admin test executions.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "spec/docs/domain-model.md"
      ]
    },
    {
      "type": "breaking",
      "description": "Replaced prompt/template form fields with `slot_payload` JSON overrides for `/api/slots/{slot_id}/test-run` and added `completed_in_seconds` to responses. Documentation updated accordingly.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md"
      ]
    },
    {
      "type": "feature",
      "description": "Added `/api/stats/slots`, success/timeout KPI fields and frontend guidance for SLA dashboards.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "frontend/stats/index.html"
      ]
    },
    {
      "type": "feature",
      "description": "Introduced JWT login (`POST /api/login`), bearer security for admin APIs, and documented token handling (scope `admin`, TTL 168 ч, throttling).",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "spec/docs/use-cases.md",
        ".memory/USECASES.md",
        "frontend/stats/assets/stats.js"
      ]
    },
    {
      "type": "breaking",
      "description": "Admin slot APIs now require template_media items to include `role`; merge behaviour preserves existing bindings for test-run and slot updates. OpenAPI updated accordingly.",
      "artifacts": [
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Задокументированы метрики/алерты `/metrics`, ops плейбук и релизный чеклист.",
      "artifacts": [
        "spec/contracts/schemas/metrics.yaml",
        "spec/docs/blueprints/ops.md",
        ".memory/INDEX.yaml"
      ]
    },
    {
      "type": "feature",
      "description": "Реализован Prometheus endpoint `/metrics` с ingest counters/histogram и gauge диска media.",
      "artifacts": [
        "src/app/stats/metrics_exporter.py",
        "src/app/stats/metrics_api.py",
        "src/app/dependencies.py"
      ]
    },
    {
      "type": "breaking",
      "description": "Ingest пароль хранится в plaintext (settings.ingest_password), возвращается через `/api/settings` и проверяется как строка в `/api/ingest/{slot_id}`; UI настроек показывает пароль без маски.",
      "artifacts": [
        "src/app/settings/settings_service.py",
        "src/app/settings/settings_schemas.py",
        "src/app/ingest/ingest_api.py",
        "src/app/ingest/ingest_service.py",
        "frontend/admin/settings.html",
        "frontend/admin/assets/settings.js",
        "spec/contracts/openapi.yaml",
        "spec/contracts/schemas/ingest-request.schema.json"
      ]
    },
    {
      "type": "feature",
      "description": "Ингест API выполняет полный вызов провайдера с бинарным ответом, сериализует запросы per-slot (429 rate_limited) и оставляет hash mismatch предупреждением; документация уточнена.",
      "artifacts": [
        "src/app/ingest/ingest_api.py",
        "src/app/ingest/ingest_service.py",
        "src/app/providers/providers_gemini.py",
        "spec/contracts/openapi.yaml",
        "spec/contracts/ingest-errors.md"
      ]
    }
  ],
  "deprecated": [],
  "breaking": true,
  "notes": "Template media bindings now carry required role field; admin slot save/test-run expect role and merge overrides without wiping existing bindings."
}
