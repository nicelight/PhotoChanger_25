{
  "version": "0.13.1",
  "released_at": "2026-01-14",
  "stage": "draft",
  "summary": "Gemini 2.5: aspect_ratio поддерживается, image_size отключён.",
  "changes": [
    {
      "type": "init",
      "description": "Defined ingest flow expectations (`POST /api/ingest/{slot_id}`) and media TTL behaviour.",
      "artifacts": [
        "spec/docs/providers/gemini.md",
        "spec/docs/providers/turbotext.md"
      ]
    },
    {
      "type": "init",
      "description": "Outlined admin APIs for slots, settings, statistics and public results delivery.",
      "artifacts": [
        "docs/PRD.md",
        "docs/ARCHITECTURE.md",
        "spec/docs/use-cases.md"
      ]
    },
    {
      "type": "docs",
      "description": "Added draft OpenAPI 3.1 specification for ingest endpoint, referencing multipart and error schemas.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "spec/contracts/schemas/ingest-request.schema.json",
        "spec/contracts/schemas/ingest-error.schema.json",
        "spec/contracts/ingest-errors.md"
      ]
    },
    {
      "type": "docs",
      "description": "Expanded ingest OpenAPI with examples and SLA description.",
      "artifacts": [
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Refined provider contracts for Gemini and Turbotext (limits, protocols, error handling).",
      "artifacts": [
        "spec/docs/providers/gemini.md",
        "spec/docs/providers/turbotext.md"
      ]
    },
    {
      "type": "docs",
      "description": "Simplified ingest media support to JPEG/PNG/WebP across PRD, SDD, and contracts.",
      "artifacts": [
        "docs/PRD.md",
        "spec/docs/use-cases.md",
        "spec/docs/nfr.md",
        "spec/contracts/schemas/ingest-request.schema.json",
        "spec/contracts/ingest-errors.md",
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Documented `/public/results/{job_id}` downloads, including 404/410 error payloads.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md"
      ]
    },
    {
      "type": "feature",
      "description": "Introduced `/api/slots/{slot_id}/test-run` and `job_history.source` to distinguish admin test executions.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "spec/docs/domain-model.md"
      ]
    },
    {
      "type": "breaking",
      "description": "Replaced prompt/template form fields with `slot_payload` JSON overrides for `/api/slots/{slot_id}/test-run` and added `completed_in_seconds` to responses. Documentation updated accordingly.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md"
      ]
    },
    {
      "type": "feature",
      "description": "Added `/api/stats/slots`, success/timeout KPI fields and frontend guidance for SLA dashboards.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "frontend/stats/index.html"
      ]
    },
    {
      "type": "feature",
      "description": "Introduced JWT login (`POST /api/login`), bearer security for admin APIs, and documented token handling (scope `admin`, TTL 168 ч, throttling).",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "docs/PRD.md",
        "spec/docs/use-cases.md",
        ".memory/USECASES.md",
        "frontend/stats/assets/stats.js"
      ]
    },
    {
      "type": "breaking",
      "description": "Admin slot APIs now require template_media items to include `role`; merge behaviour preserves existing bindings for test-run and slot updates. OpenAPI updated accordingly.",
      "artifacts": [
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "docs",
      "description": "Задокументированы метрики/алерты `/metrics`, ops плейбук и релизный чеклист.",
      "artifacts": [
        "spec/contracts/schemas/metrics.yaml",
        "spec/docs/blueprints/ops.md",
        ".memory/INDEX.yaml"
      ]
    },
    {
      "type": "feature",
      "description": "Реализован Prometheus endpoint `/metrics` с ingest counters/histogram и gauge диска media.",
      "artifacts": [
        "src/app/stats/metrics_exporter.py",
        "src/app/stats/metrics_api.py",
        "src/app/dependencies.py"
      ]
    },
    {
      "type": "breaking",
      "description": "Ingest пароль хранится в plaintext (settings.ingest_password), возвращается через `/api/settings` и проверяется как строка в `/api/ingest/{slot_id}`; UI настроек показывает пароль без маски.",
      "artifacts": [
        "src/app/settings/settings_service.py",
        "src/app/settings/settings_schemas.py",
        "src/app/ingest/ingest_api.py",
        "src/app/ingest/ingest_service.py",
        "frontend/admin/settings.html",
        "frontend/admin/assets/settings.js",
        "spec/contracts/openapi.yaml",
        "spec/contracts/schemas/ingest-request.schema.json"
      ]
    },
    {
      "type": "feature",
      "description": "Ингест API выполняет полный вызов провайдера с бинарным ответом, сериализует запросы per-slot (429 rate_limited) и оставляет hash mismatch предупреждением; документация уточнена.",
      "artifacts": [
        "src/app/ingest/ingest_api.py",
        "src/app/ingest/ingest_service.py",
        "src/app/providers/providers_gemini.py",
        "spec/contracts/openapi.yaml",
        "spec/contracts/ingest-errors.md"
      ]
    },
    {
      "type": "feature",
      "description": "Добавлено поле latest_result в ответ /api/slots/{slot_id} и задокументированы дополнительные поля результата для поддержки галереи админ-UI.",
      "artifacts": [
        "src/app/slots/slots_api.py",
        "src/app/slots/slots_schemas.py",
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "feature",
      "description": "Введена публичная галерея с временным доступом на 15 минут (/pubgallery, /api/gallery/share), rate limit и кэшем ответа.",
      "artifacts": [
        "src/app/public/public_gallery_service.py",
        "src/app/public/public_gallery_router.py",
        "src/app/public/public_gallery_admin_router.py",
        "frontend/admin/gallery.html",
        "frontend/admin/assets/gallery.js",
        "frontend/public/gallery.html",
        "frontend/public/assets/public-gallery.js",
        "spec/contracts/openapi.yaml"
      ]
    },
    {
      "type": "fix",
      "description": "Gemini NO_IMAGE: добавлены ретраи (5 попыток, 3с) и маппинг в 504 provider_timeout после исчерпания, обновлены логи и runbook.",
      "artifacts": [
        "src/app/providers/providers_gemini.py",
        "src/app/ingest/ingest_service.py",
        "tests/unit/providers/test_gemini_driver.py",
        "spec/contracts/ingest-errors.md",
        "docs/runbooks/test_playbook.md"
      ]
    },
    {
      "type": "feature",
      "description": "Добавлены recent_failures (20 последних ошибок провайдера) и увеличено окно статистики до 72 часов; UI статистики обновлён.",
      "artifacts": [
        "spec/contracts/openapi.yaml",
        "spec/contracts/ingest-errors.md",
        "src/app/stats/stats_repository.py",
        "src/app/stats/stats_service.py",
        "frontend/stats/index.html",
        "frontend/stats/assets/stats.js",
        "tests/unit/stats/test_stats_service.py",
        "tests/e2e/test_ui_stats.py"
      ]
    },
    {
      "type": "docs",
      "description": "Добавлены схемы slot.settings для Gemini 3.0 Flash и GPT‑5, уточнены правила ретраев и логирования провайдеров.",
      "artifacts": [
        "spec/contracts/schemas/slot-settings-gemini-3-flash.schema.json",
        "spec/contracts/schemas/slot-settings-gpt5.schema.json",
        "spec/docs/providers/driver-checklist.md",
        "spec/docs/providers/gemini.md",
        "spec/docs/providers/turbotext.md"
      ]
    },
    {
      "type": "feature",
      "description": "Добавлены драйверы gemini-3-pro-image-preview и gpt-image-1.5-2025-12-16 (base64 inline_data/b64_json), обновлена фабрика провайдеров и UI слотов для выбора aspect_ratio/resolution.",
      "artifacts": [
        "src/app/providers/providers_gemini_3_pro.py",
        "src/app/providers/providers_gpt_image_1_5.py",
        "src/app/providers/providers_factory.py",
        "frontend/slots/template.html",
        "frontend/slots/slot-001.html",
        "frontend/slots/slot-002.html",
        "frontend/slots/slot-003.html",
        "frontend/slots/slot-004.html",
        "frontend/slots/slot-005.html",
        "frontend/slots/slot-006.html",
        "frontend/slots/slot-007.html",
        "frontend/slots/slot-008.html",
        "frontend/slots/slot-009.html",
        "frontend/slots/slot-010.html",
        "frontend/slots/slot-011.html",
        "frontend/slots/slot-012.html",
        "frontend/slots/slot-013.html",
        "frontend/slots/slot-014.html",
        "frontend/slots/slot-015.html",
        "frontend/slots/assets/slot-config.js",
        "frontend/slots/assets/slot-main.js",
        "frontend/slots/assets/slot-api.js",
        "frontend/slots/assets/slot.css"
      ]
    },
    {
      "type": "docs",
      "description": "Добавлены спецификации и справки по Gemini 3 Pro Image Preview и GPT Image 1.5 (base64, imageConfig/size, логирование, ретраи).",
      "artifacts": [
        "spec/docs/providers/gemini-3-pro/README.md",
        "spec/docs/providers/gemini-3-pro/base64-inline-data.md",
        "spec/docs/providers/gemini-3-pro/image-config.md",
        "spec/docs/providers/GPT-image-1.5/README.md",
        "spec/docs/providers/GPT-image-1.5/image-api-edits.md",
        "spec/docs/providers/GPT-image-1.5/image-output-options.md"
      ]
    },
    {
      "type": "docs",
      "description": "Добавлены схемы slot.settings для Gemini 3 Pro и GPT Image 1.5.",
      "artifacts": [
        "spec/contracts/schemas/slot-settings-gemini-3-pro.schema.json",
        "spec/contracts/schemas/slot-settings-gpt-image-1.5.schema.json"
      ]
    },
    {
      "type": "test",
      "description": "Добавлены unit-тесты драйверов Gemini 3 Pro и GPT Image 1.5.",
      "artifacts": [
        "tests/unit/providers/test_gemini3_pro_driver.py",
        "tests/unit/providers/test_gpt_image_1_5_driver.py"
      ]
    },
    {
      "type": "feature",
      "description": "Gemini 2.5: добавлена поддержка imageConfig (aspect_ratio/imageSize) в драйвере и UI, расширена schema slot.settings.",
      "artifacts": [
        "src/app/providers/providers_gemini.py",
        "spec/contracts/schemas/slot-settings-gemini.schema.json",
        "frontend/slots/assets/slot-api.js",
        "frontend/slots/assets/slot-main.js"
      ]
    },
    {
      "type": "docs",
      "description": "Обновлена справка Gemini 2.5 с параметрами imageConfig (aspect_ratio/resolution).",
      "artifacts": [
        "spec/docs/providers/gemini-2.5/gemini.md"
      ]
    },
    {
      "type": "test",
      "description": "Дополнены unit-тесты GeminiDriver проверкой imageConfig.",
      "artifacts": [
        "tests/unit/providers/test_gemini_driver.py"
      ]
    },
    {
      "type": "fix",
      "description": "Gemini 2.5: imageConfig ограничен только aspect_ratio, image_size больше не отправляется; UI и схема обновлены.",
      "artifacts": [
        "src/app/providers/providers_gemini.py",
        "frontend/slots/assets/slot-api.js",
        "frontend/slots/assets/slot-main.js",
        "spec/contracts/schemas/slot-settings-gemini.schema.json",
        "spec/docs/providers/gemini-2.5/gemini.md",
        "tests/unit/providers/test_gemini_driver.py"
      ]
    }
  ],
  "deprecated": [],
  "breaking": false,
  "notes": "Gemini 2.5: поддерживается только aspect_ratio; image_size отключён."
}
