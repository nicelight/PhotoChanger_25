{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Job",
  "type": "object",
  "required": [
    "id",
    "slot_id",
    "status",
    "is_finalized",
    "expires_at",
    "created_at",
    "updated_at"
  ],
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid"
    },
    "slot_id": {
      "type": "string",
      "description": "Идентификатор слота, из которого была создана задача.",
      "enum": [
        "slot-001",
        "slot-002",
        "slot-003",
        "slot-004",
        "slot-005",
        "slot-006",
        "slot-007",
        "slot-008",
        "slot-009",
        "slot-010",
        "slot-011",
        "slot-012",
        "slot-013",
        "slot-014",
        "slot-015"
      ]
    },
    "status": {
      "type": "string",
      "enum": ["pending", "processing"],
      "description": "Промежуточное состояние обработки до финализации."
    },
    "is_finalized": {
      "type": "boolean",
      "description": "Признак того, что задача завершена (успех или ошибка)."
    },
    "failure_reason": {
      "description": "Причина неуспешного завершения. Присутствует только если is_finalized = true и обработка не удалась.",
      "oneOf": [
        {
          "type": "string",
          "enum": ["timeout", "provider_error", "cancelled"]
        },
        {
          "type": "null"
        }
      ]
    },
    "provider_job_reference": {
      "type": ["string", "null"],
      "description": "Опциональный идентификатор очереди внешнего провайдера (например, `queueid` Turbotext для polling)."
    },
    "payload_path": {
      "type": ["string", "null"],
      "description": "Путь к исходному ingest-файлу во временном хранилище."
    },
    "result_file_path": {
      "type": ["string", "null"],
      "description": "Относительный путь к итоговому файлу результата в MEDIA_ROOT/results."
    },
    "result_inline_base64": {
      "type": ["string", "null"],
      "contentEncoding": "base64",
      "description": "Временная base64-строка результата для синхронного ответа ingest; очищается сразу после отправки HTTP 200 или таймаута."
    },
    "result_mime_type": {
      "type": ["string", "null"],
      "description": "MIME-тип итогового изображения."
    },
    "result_size_bytes": {
      "type": ["integer", "null"],
      "minimum": 0,
      "description": "Размер результата в байтах."
    },
    "result_checksum": {
      "type": ["string", "null"],
      "description": "Контрольная сумма содержимого (например, SHA-256 в hex)."
    },
    "result_expires_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Момент автоочистки итогового файла (`finalized_at + T_result_retention`, по умолчанию 72 часа)."
    },
    "expires_at": {
      "type": "string",
      "format": "date-time",
      "description": "Единый дедлайн задачи: фиксируется при создании как created_at + T_sync_response и используется API/воркерами для контроля таймаутов."
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    },
    "finalized_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Момент фиксации финального состояния."
    }
  },
  "additionalProperties": false
}
