# Acceptance Criteria — PhotoChanger

Документ синхронизируется с `docs/PRD.md` §13 и `spec/docs/use-cases.md`. Каждый критерий должен быть подтверждён тестами (см. `spec/docs/test-plan.md`) и отражён в чеклистах релиза.

| ID | Сценарий | Критерии приемки |
|----|----------|------------------|
| AC-01 | Успешный ingest (UC2) | 1) `POST /api/ingest/{slot_id}` с валидным payload возвращает 200 ≤ `T_sync_response`; 2) `job_history.status = done`, `result_path` указывает на файл в `media/results`; 3) `/public/results/{job_id}` доступен 72 ч с корректным MIME. |
| AC-02 | Таймаут ingest (UC3) | 1) При ручном ограничении драйвера > `T_sync_response` API отвечает 504; 2) `job_history.status = timeout`, `failure_reason = T_sync_response_exceeded`; 3) временные файлы удалены, повторный `GET` → `410 Gone`. |
| AC-03 | Ошибка провайдера | 1) Искусственный `provider_error` из драйвера даёт 502; 2) `job_history.status = failed`, лог содержит `provider_error` и идентификатор запроса; 3) статистика `/api/stats` отображает рост доли ошибок. |
| AC-04 | Управление слотами (UC1) | 1) `PUT /api/slots/{slot_id}` валидирует схему и сохраняет конфигурацию; 2) версия слота увеличивается, журнал фиксирует изменение; 3) ingest использует обновлённый слот без перезапуска приложения. |
| AC-05 | Ротация ingest-пароля (UC0) | 1) `PUT /api/settings` обновляет хэш пароля; 2) следующий ingest с новым паролем проходит, старый — получает `401`; 3) в `/api/settings` отображаются автор и время обновления. |
| AC-06 | Шаблонные медиа и галерея (UC5) | 1) Загрузка шаблона проверяет MIME/размер и привязывает к слоту; 2) галерея показывает последние 10 результатов; 3) просроченные результаты автом. исключаются из списка. |
| AC-07 | Наблюдаемость и очистка (UC6) | 1) Cron `cleanup_media.py` удаляет просроченные записи и выставляет `cleaned_at`; 2) `/metrics` содержит p95, долю 504, размер `media/`; 3) `/healthz` проверяет БД, файловую систему, провайдеров. |
| AC-08 | Безопасность доступа | 1) Неверный ingest пароль → `401` с аудитом; 2) >10 неверных логинов → `429`; 3) админ JWT истекает через 24 ч; 4) API логи не содержат бинарных тел. |
