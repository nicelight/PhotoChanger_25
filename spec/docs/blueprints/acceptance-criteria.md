# Acceptance Criteria

## AC1. Настройка слота
- [ ] API принимает и валидирует выбор провайдера и операции; при неверных полях возвращает `422` с подробностями.
- [ ] Сохранённый слот возвращает ingest-URL и секрет; UI отображает ссылку и кнопку копирования.
- [ ] Изменение слота не влияет на уже запущенные Job; новые задачи используют обновлённые параметры.

## AC2. Ingest успешный (200 OK)
- [ ] При валидном пароле и файле Job создаётся в статусе `pending` и переходит в `processing`.
- [ ] Воркер завершает обработку до наступления `T_sync_response` и возвращает изображение.
- [ ] Исходный временный файл удаляется сразу после фиксации `completed`.
- [ ] Результат доступен по ID в течение 72 часов.

## AC3. Ingest с таймаутом (504)
- [ ] API прекращает ожидание строго по `T_sync_response` и отдаёт 504.
- [ ] Job помечается `failed_timeout`, дальнейшие ретраи не запускаются.
- [ ] Все временные файлы и сетевые операции воркера отменяются и очищаются.

## AC4. Продление `media_object`
- [ ] `POST /api/media/extend` разрешён только при статусе Job `pending/processing`.
- [ ] TTL не может превышать `media.max_manual_ttl_sec` и не может быть меньше текущего времени.
- [ ] После финального статуса Job запрос возвращает `409 Conflict` и инициирует очистку файла.

## AC5. Управление шаблонными медиа
- [ ] `POST /api/template-media/register` принимает только допустимые форматы и размеры; при превышении — `415/413`.
- [ ] Привязка к слоту обновляется атомарно; при удалении шаблона слоты теряют ссылки и уведомляют администратора.
- [ ] `DELETE /api/template-media/{id}` недоступен, если шаблон используется активным слотом без подтверждения.

## AC6. Мониторинг и алерты
- [ ] Метрики по p95 ingest, количеству активных Job и использованию `MEDIA_ROOT` доступны в системе мониторинга.
- [ ] Логи фиксируют входящие ingest, статусы Job и ошибки провайдеров без хранения бинарных данных.
- [ ] Алерт срабатывает при превышении доли `failed_timeout` > 5% в течение 5 минут.
