# Контекст и границы PhotoChanger

## Системная граница
Платформа PhotoChanger развёрнута как HTTP-сервер, принимающий ingest-запросы и управляющий AI-обработкой фотографий согласно `/Docs/brief.md`. Система включает:
- Ingest API c валидацией входящих POST от DSLR Remote Pro.
- Очередь задач на PostgreSQL и воркеры.
- Адаптеры провайдеров (Gemini, Turbotext и др.).
- Временное и постоянное медиа-хранилище.
- Административный UI/API для управления слотами и шаблонными медиа.

## Внешние акторы
- **DSLR Remote Pro** — отправляет `POST /ingest/{slotId}` с фото и секретом.
- **Администратор** — настраивает слоты, загружает шаблонные медиа, при необходимости повторно регистрирует временные ссылки.
- **AI-провайдеры** — внешние API, выполняющие операции по настройкам слота.
- **Система мониторинга/логирования** — получает технические метрики и алерты.
- **Потребители публичных ссылок** — Turbotext и другие клиенты, скачивающие временные файлы по `GET /public/media/{id}`.

## Диаграмма контекста
```mermaid
flowchart LR
    subgraph PhotoChanger Platform
        API[Ingest & Admin API]
        Queue[Очередь задач]
        Worker[AI Workers]
        Storage[Media Storage]
        Providers[Адаптеры провайдеров]
        UI[Slot Management UI]
    end

    DSLR[DSLR Remote Pro] -->|POST /ingest/{slotId}| API
    Admin[Администратор] -->|JWT + UI/API| UI
    UI -->|Конфигурация слотов| API
    API --> Queue
    Queue --> Worker
    Worker --> Providers
    Providers --> Worker
    Worker --> Storage
    Storage -->|GET /public/media/{id}| ExternalClient[Провайдеры, скачивающие public_url]
    API -->|Результат / 504| DSLR
    Monitoring[Мониторинг/Логи] <-->|Метрики, события| API
```

## Scope и out-of-scope
### Внутри границ
- Управление жизненным циклом Slot и Job.
- Очередь задач с контролем дедлайна `T_sync_response`.
- Валидация и очистка временных медиа-объектов.
- Интеграция с Gemini и Turbotext по контрактам брифа.
- Базовая авторизация и JWT-аутентификация для административных операций.

### Вне границ (требуют отдельного согласования)
- Управление пользователями и выдача JWT (предполагается внешний Identity Provider).
- Расширенные UI-фичи (advanced analytics, drag&drop верстка) сверх базовой настройки слотов.
- Автоматическое продление TTL воркерами после финальных статусов.
- Масштабирование очереди за пределы PostgreSQL (например, Kafka) — рассматривается в будущих итерациях.

## Зависимости и интеграции
- Подключение к файловой системе/облачному стореджу для `MEDIA_ROOT`.
- Доступ к внешнему интернету для вызовов AI-провайдеров и отдачи публичных ссылок.
- Поддержание TLS-сертификатов для HTTPS, чтобы соответствовать требованиям безопасности ingest и публичных ссылок.
