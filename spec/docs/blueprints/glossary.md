# Глоссарий PhotoChanger

- **Slot** — статическая конфигурация обработки (`slot-001`…`slot-015`), которая определяет провайдера (Gemini/Turbotext), операцию, параметры и связанные шаблонные медиа. Используется для построения ingest-ссылки `<BASE_URL>/ingest/{slot_id}` и не содержит индивидуальных секретов.
- **Ingest API** — HTTP-эндпоинт `POST /ingest/{slotId}` для получения фотографий от DSLR Remote Pro, расчёта дедлайнов и выдачи результата либо 504 по истечении `T_sync_response` (10–60 с).
- **T_sync_response** — максимальное окно ожидания синхронного ответа ingest API (по умолчанию 48 с, допустимый диапазон 10–60 с); Настраивается через `/api/settings`.
- **T_ingest_ttl** — TTL исходных ingest-файлов во временном хранилище (`payload_path`), совпадает с `T_sync_response`.
- **T_public_link_ttl** — TTL временных публичных ссылок (`media_object`), равный `T_sync_response`; после истечения ссылка удаляется.
- **T_result_retention** — фиксированный TTL итоговых файлов (72 ч) и публичных ссылок `GET /public/results/{job_id}`; после истечения endpoint возвращает `410 Gone`, а файл удаляется очистителем. 
- **MediaObject** — временный публичный файл с TTL = `T_public_link_ttl = T_sync_response`, выдаваемый через `POST /api/media/register` для загрузок провайдера (например, Turbotext). По истечении срока запись удаляется.
- **Media public link** — одноразовый URL на `MediaObject`, доступный провайдерам (Turbotext) в пределах `T_public_link_ttl`; истечение делает ссылку недоступной.
- **TemplateMedia** — долговечные шаблонные изображения без публичных ссылок, привязываемые к слотам через UI/API. Удаляются вручную при обновлении слота. Проверяются на допустимый MIME/размер при загрузке. 
- **DSLR Remote Pro** — настольный клиент, который отправляет multipart `POST /ingest/{slotId}` с фото, паролем и метаданными, запускающими обработку в выбранном слоте.
- **JobContext** — внутренняя структура `IngestService`, содержащая `job_id`, данные о слоте, пути к временным файлам, параметры провайдера и дедлайны; прокидывается во все драйверы.
- **ProviderDriver** — абстракция над внешним AI-провайдером с методом `process(job_ctx) -> ProviderResult`, отвечающая за сетевые вызовы, подготовку payload и интерпретацию ответов (реализации: `GeminiDriver`, `TurbotextDriver`).
- **ProviderResult** — унифицированное представление ответа провайдера (inline bytes или ссылка на файл), на основании которого `IngestService` сохраняет итоговое изображение и обновляет `job_history`.
- **TempMediaStore** — подсистема хранения исходных файлов в `MEDIA_ROOT/temp`; управляет TTL = `T_sync_response`, используется при подготовке данных для провайдеров.
- **ResultStore** — подсистема хранения итоговых файлов в `MEDIA_ROOT/results` с TTL = `T_result_retention`, обеспечивает публикацию `GET /public/results/{job_id}`.
- **Cleanup cron** — скрипт `scripts/cleanup_media.py`, который периодически удаляет просроченные записи temp/result, актуализирует `media_object` и освобождает диск.
- **AppConfig** — центральная точка сборки конфигурации FastAPI-приложения (подключение БД, словарь драйверов, переменные окружения), используемая как при запуске, так и в тестах.
- **Ingest password** — глобальный секрет для DSLR Remote Pro, хэш которого хранится в `app_settings` (`ingest.dslr_password`) и проверяется при каждом `POST /ingest/{slotId}`.
- **Admin JWT** — статический токен авторизации администраторов (`serg`, `igor`), выдаваемый через `/api/login` и использующийся для доступа к `/api/slots`, `/api/settings`, `/api/stats`.
- **StatsService** — модуль, агрегирующий показатели SLA (p95, доля 504, загрузка слотов) на основании таблиц `job_history` и `slot`, публикуемый через `/api/stats`.
