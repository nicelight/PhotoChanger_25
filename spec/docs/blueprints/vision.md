# Vision PhotoChanger

## Цель продукта
Создать серверную платформу обработки фотографий с AI-провайдерами, которая позволяет администраторам настраивать "слоты" обработки и принимать ingest-запросы от DSLR Remote Pro в течение настраиваемого окна `T_sync_response` (10–60 с), возвращая результат или консистентно завершая запрос ошибкой 504 в рамках установленных правил, а также предоставляя итоговое изображение по публичной ссылке в течение 72 часов.

## Уникальная ценность
- Единая точка интеграции с несколькими провайдерами (Gemini, Turbotext и др.) с учётом их лимитов, форматов и квот.
- Сохранение консистентности медиа-объектов: исходные файлы живут только в статусах `pending/processing`, а результаты фиксируются в полях `Job.result_*` как последний успешный ответ; base64-строка `result_inline_base64` живёт лишь до завершения синхронного ответа, после чего итоговый файл доступен по ссылке 72 часа (`T_result_retention`).
- Управление слотовыми настройками через UI с выдачей ingest-ссылок, которые совместимы с DSLR Remote Pro без доработок клиента.
- Галерея последних результатов в UI: компактные превью и кнопки скачивания.

## Роль в экосистеме
PhotoChanger — промежуточное звено между DSLR Remote Pro и внешними AI-провайдерами.  
Он обеспечивает приём данных, маршрутизацию запросов к моделям и публикацию готового результата с временным хранением.

## Целевые пользователи и заинтересованные стороны
- **Администраторы контента** — создают и настраивают слоты, управляют шаблонными медиа.
- **Операторы студий** — запускают обработку из DSLR Remote Pro, контролируют статусы задач.
- **AI-провайдеры** — внешние сервисы, предоставляющие модели обработки изображений.
- **Команда эксплуатации** — следит за метриками, логами, перезапусками очереди и очистителями медиа.


## Внешние ограничения и зависимости
- DSLR Remote Pro формирует фиксированный multipart POST с полями `password`, данными файла и метаданными; сервер должен корректно обрабатывать вариации необязательных полей.
- Лимиты провайдеров (размер файлов Gemini ≤ 2 ГБ, набор допустимых MIME: JPEG/PNG/WEBP/HEIC/HEIF и др.) диктуют валидацию входных данных.
- Публичное медиа-хранилище должно гарантировать доступность итоговых файлов в течение полного окна `T_result_retention = 72h`.  
`Job.expires_at` указывает время истечения этого TTL, а не окна синхронного ответа (`T_sync_response`).


## Стратегические вехи
1. Формулировка требований и согласование архитектуры ingest/media.
2. Реализация контрактов ingest/media + стабы API.
3. Интеграция очереди, воркеров и первого провайдера (Gemini).
4. Подключение Turbotext с публичными ссылками, настройка очистителей медиа.
5. Вывод MVP в эксплуатацию с мониторингом.
