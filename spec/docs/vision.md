# Vision — PhotoChanger

## 1. Контекст
- PhotoChanger — синхронная платформа обработки фотографий между DSLR Remote Pro и AI-провайдерами (Gemini, Turbotext), развёрнутая как монолит FastAPI + PostgreSQL + файловое хранилище (`docs/PRD.md`, `docs/ARCHITECTURE.md`, ADR-0001).
- Миссия: обеспечить предсказуемый SLA ≤60 с для ingest-запросов, предоставить администраторам управляемые слоты и прозрачную статистику, а итоговые медиа хранить 72 ч (`.memory/MISSION.md`).
- Архитектура намеренно KISS: один процесс, драйверы провайдеров в виде плагинов, cron-скрипт очистки и отсутствие внешнего rate limiting (решение тимлида от 2025-10-31, `.memory/WORKLOG.md`).

## 2. Целевая ценность
- **Администраторы контента** получают централизованное управление 15 слотами, шаблонными медиа и настройками SLA.
- **Операторы фотозон** запускают обработку из DSLR Remote Pro и получают быстрый результат или корректный сигнал об ошибке.
- **Команда эксплуатации** контролирует выполнение SLA, видит метрики и управляет очисткой медиа.
- **Провайдеры AI** интегрируются через единый контракт драйверов и получают временные ссылки на исходные медиа.

## 3. Пользователи и заинтересованные стороны
| Роль | Цели | Ключевые интерфейсы |
|------|------|---------------------|
| Администратор | Настройка слотов, ротация паролей, аудит изменений | `/api/login`, `/api/slots`, `/api/settings`, Admin UI |
| Оператор | Старт обработки и контроль статуса | `/api/ingest/{slot_id}`, `/public/results/{job_id}` |
| Ops | Мониторинг, очистка медиа, управление секретами | `/metrics`, `/healthz`, cron `cleanup_media.py` |
| Провайдер | Получение входных данных и отдача результата | Временные ссылки (`media_object`), драйверы Gemini/Turbotext |

## 4. Целевые метрики и SLA
- ≥95 % ingest-запросов завершаются HTTP 200 в пределах `T_sync_response` (конфигурируемо 10–60 с, по умолчанию 48 с).
- ≤5 % запросов завершаются 504/`provider_error` при стабильных провайдерах.
- Итоговые файлы доступны 72 ч (`T_result_retention`), затем удаляются автоматически; отклонения >15 мин считаются инцидентом.
- Admin UI выполняет CRUD-операции <1 с при номинальной нагрузке, а `/metrics` и `/healthz` доступны всегда.

## 5. Этапы развития (roadmap)
1. **US PHC-1.0.x** — подготовка полного пакета SDD (документы + диаграммы) и OpenAPI ingest API.
2. **US PHC-1.1.x** — реализация ingest-флоу, валидаций и статусов `pending/done/timeout/failed`.
3. **US PHC-1.2.x** — интеграция Gemini и Turbotext, публикация provider specs и контрактных тестов.
4. **US PHC-1.3.x** — завершение TTL-пайплайна, cron-очистка, observability.
5. **EP PHC-2 / PHC-3** — админ-панель, мониторинг, релизные процедуры и дальнейшие улучшения.
